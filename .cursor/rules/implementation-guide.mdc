---
description: implementation guide
globs: 
alwaysApply: false
---
# AIコーディングエージェント実装ガイド

このガイドでは{{AIコーディングエージェント}}を使った実装を進める方法について述べる。
以下自動実行が可能なワークフローとしているが、実行のための情報が足りない場合は必ずユーザーに問い合わせること。

## ワークフロー
- {{設計書}}を{{AIコーディングエージェント}}で実装するために適したサイズに分割し、それぞれ{{実装指示書}}を作成する。既に作成されている場合はスキップ。
- {{実装に必要な情報}}を確認し、足りない情報は収集する。もしくはユーザーに許可を得て生成する。
- 全ての{{実装指示書}}に対応する実装が完了するまで以下繰り返す
  - {{設計書}}と{{実装指示書}}を読み、{{実装指示書}}の内容と{{設計書}}全体のどの部分かの位置づけを理解する。
  - {{ブランチ作成}}する
  - {{AIコーディング}}実行
  - {{レビュー}}し、{{実装評価}}が合格ラインに到達していれば{{コミット}}して次の実装に進む
  - {{実装評価}}が合格ライン未満であれば、合格ラインを超えられるよう{{実装指示書}}を改善し、{{リトライブランチ}}で{{ブランチ作成}}からリトライ。リトライは最大3回まで。
- {{設計書}}と現在の実装を比較、評価し、必要に応じてファイルの追加、修正を抽出。
- これまでの{{AIコーディングエージェント}}の{{実装評価}}を振り返り、足りないファイルや必要な修正を抽出。
- 評価の結果、未実装ファイルや修正が必要な箇所が発見されれば、それらを実装、修正するための{{実装指示書}}を新規作成する。
- 新たな{{実装指示書}}を元に、{{完了ブランチ}}の作成、{{AIコーディング}}実行}が合格ラインに到達するまでリトライ。リトライは最大3回まで。
- {{設計書}}による実装をテストするためのCLIやガイドをユーザーに提示して終了


## 定義
- name: ベースブランチ
  action: ask_question
  question: ベースブランチを教えて下さい
  description: 実装を始めるベースとなるブランチ名

- name: デザイン名
  action: ask_question
  question: デザイン名を教えて下さい。設計書が デザイン名.mdc で存在する前提です。
  description: デザイン（設計）の名前。ユーザーから与えられる。

- name: 実装に必要な情報
  description: {{ベースブランチ}}, {{デザイン名}}, {{設計書}}, {{実装指示書}}が必要。

- name: 設計書
  description: ある機能を実現するための設計書。 @design-guide.mdc にしたがって作成され、本ガイドを実行する前に別途用意される。
  path: doc/design/{{デザイン名}}.mdc

- name: 実装指示書
  description: {{AIコーディングエージェント}}が理解し、可能な限り高い品質でコード生成できるように考慮したプロンプト。{{指示書名}}は{{設計書}}の該当の部分と紐づける名前とする。
  path: doc/agent-prompts/日付_{{デザイン名}}/{{指示書名}}.md

- name: AIコーディング
  action: claude_code
  dexcription: {{AIコーディングエージェント}}に{{実装指示書}}を読ませ、実装すること。

- name: AIコーディングエージェント
  description: Claude によるコーディング専用のAIエージェント。{{claude_code}}コマンドによりCLI経由で起動、実行できる。

- name: claude_code
  action: 'cat {{実装指示書}} | claude --allowedTools "Write,MultiEdit" --verbose -p "run this prompt"'
  description: Claude code CLIによる実装開始コマンド。{{実装指示書}}の内容をclaude CLIの標準入力に与える。actionをチャット欄のyoloモードで実行。ユーザー許可不要。

- name: ブランチ作成
  action: git checkout -b {{ブランチ}}
  action: git checkout -b {{リトライブランチ}}
  action: git checkout -b {{完了ブランチ}}
  description: 各{{実装指示書}}の実装結果を保管するブランチを作成する。ベースブランチは、直前の{{実装指示書}}のブランチとする。いずれかのアクションを選択。

- name: 基本ブランチ
  branch: claude/{{デザイン名}}_{{指示書名}}
  description: AIコーディング結果を保存するためのブランチ。ブランチ名は状況に応じて基本ブランチ、{{リトライブランチ}}、{{完了ブランチ}}など適切なものを選択する

- name: 完了ブランチ
  branch: {{基本ブランチ}}_final
  description: 全ての{{実装指示書}}による実装後、{{設計書}}との差を埋めるための実装を保存するブランチ。

- name: リトライブランチ
  branch: {{基本ブランチ}}_retry{{リトライ回数}}
  branch: {{完了ブランチ}}_retry{{リトライ回数}}
  description: {{基本ブランチ}}や{{完了ブランチ}}の再実行用のブランチ名。

- name: レビュー
  description: {{実装指示書}}による実装を100点満点で{{実装評価}}する。

- name: 実装評価
  description: 実装の評価値。100点満点。80点以上を合格ラインとする。
  
- name: コミット
  action: git commit -m 'AI implemented {{指示書名}}'
  description: 実装結果をコミットする。ユーザー許可不要。
